{% load humanize %}

<div id="sidebar-item-{{ conversation.id }}" hx-swap-oob="true"
     hx-get="{% url 'chat_conversation' other_user.id %}"
     hx-target="#chat-content"
     hx-swap="innerHTML"
     onclick="openChat('user_{{ other_user.id }}')"
     class="chat-item flex items-center gap-3 p-3 rounded-xl hover:bg-white dark:hover:bg-white/5 border border-transparent hover:border-gray-200 dark:hover:border-white/5 cursor-pointer transition-all group">
    
    <div class="relative z-10">
        <img src="https://ui-avatars.com/api/?name={{ other_user.username }}&background=7928ca&color=fff" class="w-12 h-12 rounded-full object-cover">
        <span id="status_indicator_{{ other_user.id }}" class="absolute bottom-0 right-0 w-3 h-3 {% if other_user.is_online %}bg-green-500{% else %}bg-gray-400{% endif %} border-2 border-white dark:border-black rounded-full transition-colors duration-300"></span>
    </div>
    
    <div class="flex-1 min-w-0 z-10">
        <div class="flex justify-between items-baseline mb-0.5">
            <h3 class="font-bold text-gray-900 dark:text-white truncate">{{ other_user.username }}</h3>
            
            {% with last_msg=conversation.get_last_message %}
                {% if last_msg %}
                    <span class="text-[10px] font-mono {% if conversation.get_unread_count > 0 %}text-brand-cyan font-bold{% else %}text-gray-500{% endif %}">
                        {{ last_msg.created_at|naturalday|title }}
                    </span>
                {% endif %}
            {% endwith %}
        </div>
        
        <div class="flex justify-between items-center">
            <p class="text-sm text-gray-600 dark:text-gray-400 truncate pr-2">
                {% with last_msg=conversation.get_last_message %}
                    {% if last_msg %}
                        {% if last_msg.sender == current_user %}
                            <i class="fa-solid fa-check{% if last_msg.is_read %}-double text-blue-500{% else %} text-gray-400{% endif %} text-[10px] mr-1"></i>
                        {% endif %}
                        {{ last_msg.body }}
                    {% else %}
                        <span class="italic opacity-50">No messages yet</span>
                    {% endif %}
                {% endwith %}
            </p>
            
            {% with unread_count=conversation.get_unread_count|default:"0" %}
                {% if unread_count|add:"0" > 0 %}
                    <span class="w-5 h-5 rounded-full bg-brand-cyan text-black text-[10px] font-bold flex items-center justify-center shadow-sm shrink-0">
                        {{ unread_count }}
                    </span>
                {% endif %}
            {% endwith %}
        </div>
    </div>
</div>