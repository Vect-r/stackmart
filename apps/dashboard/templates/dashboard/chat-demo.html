{% extends "dashboard/base.html" %}
{% load static %}

{% block title %}Chat | Stackmart{% endblock %}

{% block extra_head %}
<style>
    .chat-container {
        height: calc(100vh - 16rem);
    }
    
    .message-bubble {
        max-width: 65%;
        word-wrap: break-word;
    }
    
    .message-time {
        font-size: 0.7rem;
    }
    
    @media (max-width: 768px) {
        .chat-container {
            height: calc(100vh - 10rem);
        }
        .message-bubble {
            max-width: 80%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="flex h-full chat-container">
    
    <!-- LEFT SIDEBAR - Conversations List -->
    <div class="w-full md:w-1/3 lg:w-1/4 bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border-r border-gray-200 dark:border-gray-700 flex flex-col">
        
        <!-- Search Bar -->
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <div class="relative">
                <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                    <i class="fa-solid fa-search text-sm"></i>
                </span>
                <input type="text" 
                    class="w-full bg-gray-100 dark:bg-gray-900 border-none text-gray-900 dark:text-gray-300 text-sm rounded-lg focus:ring-brand-purple focus:border-brand-purple pl-10 p-2.5 font-mono transition-colors"
                    placeholder="Search conversations...">
            </div>
        </div>
        
        <!-- Conversations List -->
        <div class="flex-1 overflow-y-auto">
            <!-- Demo Conversation 1 - Active -->
            <div class="flex items-center gap-3 p-4 hover:bg-gray-50/50 dark:hover:bg-gray-750/50 cursor-pointer bg-gray-100/50 dark:bg-gray-900/50 backdrop-blur-sm border-l-4 border-brand-cyan transition-colors">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                        class="w-12 h-12 rounded-full">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></span>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 truncate">John Doe</h3>
                        <span class="text-xs text-gray-500 font-mono">2:45 PM</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Is the GPU still available?</p>
                </div>
                <div class="flex flex-col items-end gap-1">
                    <span class="bg-brand-cyan text-white text-xs rounded-full px-2 py-0.5 font-bold">3</span>
                </div>
            </div>

            <!-- Demo Conversation 2 -->
            <div class="flex items-center gap-3 p-4 hover:bg-gray-50/50 dark:hover:bg-gray-750/50 backdrop-blur-sm cursor-pointer transition-colors">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=Sarah+Smith&background=7928ca&color=fff&bold=true" 
                        class="w-12 h-12 rounded-full">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 truncate">Sarah Smith</h3>
                        <span class="text-xs text-gray-500 font-mono">Yesterday</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 truncate">
                        <i class="fa-solid fa-check-double text-blue-500 text-xs"></i> Thanks for the quick delivery!
                    </p>
                </div>
            </div>

            <!-- Demo Conversation 3 -->
            <div class="flex items-center gap-3 p-4 hover:bg-gray-50/50 dark:hover:bg-gray-750/50 backdrop-blur-sm cursor-pointer transition-colors">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=Mike+Johnson&background=ff0080&color=fff&bold=true" 
                        class="w-12 h-12 rounded-full">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></span>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 truncate">Mike Johnson</h3>
                        <span class="text-xs text-gray-500 font-mono">Monday</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Can you ship to New York?</p>
                </div>
            </div>

            <!-- Demo Conversation 4 -->
            <div class="flex items-center gap-3 p-4 hover:bg-gray-50/50 dark:hover:bg-gray-750/50 backdrop-blur-sm cursor-pointer transition-colors">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=Emma+Wilson&background=00dfd8&color=fff&bold=true" 
                        class="w-12 h-12 rounded-full">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 truncate">Emma Wilson</h3>
                        <span class="text-xs text-gray-500 font-mono">Last week</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 truncate">
                        <i class="fa-solid fa-check text-gray-400 text-xs"></i> Perfect condition, as described
                    </p>
                </div>
            </div>

            <!-- Demo Conversation 5 -->
            <div class="flex items-center gap-3 p-4 hover:bg-gray-50/50 dark:hover:bg-gray-750/50 backdrop-blur-sm cursor-pointer transition-colors">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=Alex+Brown&background=7928ca&color=fff&bold=true" 
                        class="w-12 h-12 rounded-full">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center justify-between">
                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 truncate">Alex Brown</h3>
                        <span class="text-xs text-gray-500 font-mono">12/02</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 truncate">Looking for server RAM</p>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT SECTION - Chat Messages -->
    <div class="flex-1 flex flex-col bg-gray-50/50 dark:bg-gray-900/50 backdrop-blur-md">
        
        <!-- Chat Header -->
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                        class="w-10 h-10 rounded-full">
                    <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></span>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-900 dark:text-gray-100">John Doe</h3>
                    <p class="text-xs text-green-500 font-mono">Online</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                    <i class="fa-solid fa-phone text-gray-600 dark:text-gray-400"></i>
                </button>
                <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                    <i class="fa-solid fa-video text-gray-600 dark:text-gray-400"></i>
                </button>
                <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                    <i class="fa-solid fa-ellipsis-vertical text-gray-600 dark:text-gray-400"></i>
                </button>
            </div>
        </div>

        <!-- Messages Container -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messages-container">
            
            <!-- Date Divider -->
            <div class="flex items-center justify-center my-4">
                <div class="bg-gray-200/70 dark:bg-gray-700/70 backdrop-blur-sm text-gray-600 dark:text-gray-400 text-xs font-mono px-4 py-1 rounded-full">
                    Today
                </div>
            </div>

            <!-- Received Message -->
            <div class="flex items-start gap-2">
                <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                    class="w-8 h-8 rounded-full">
                <div class="message-bubble bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                    <p class="text-gray-800 dark:text-gray-200 text-sm">Hey! I'm interested in the RTX 3090 you have listed.</p>
                    <span class="message-time text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1 justify-end">
                        2:30 PM
                    </span>
                </div>
            </div>

            <!-- Received Message -->
            <div class="flex items-start gap-2">
                <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                    class="w-8 h-8 rounded-full">
                <div class="message-bubble bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                    <p class="text-gray-800 dark:text-gray-200 text-sm">Is it still available?</p>
                    <span class="message-time text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1 justify-end">
                        2:30 PM
                    </span>
                </div>
            </div>

            <!-- Sent Message -->
            <div class="flex items-end gap-2 justify-end">
                <div class="message-bubble bg-gradient-to-r from-brand-cyan to-brand-purple rounded-2xl rounded-br-none p-3 shadow-sm">
                    <p class="text-white text-sm">Yes! It's still available. Are you interested?</p>
                    <span class="message-time text-white/80 flex items-center gap-1 mt-1 justify-end">
                        2:35 PM <i class="fa-solid fa-check text-xs"></i>
                    </span>
                </div>
            </div>

            <!-- Sent Message with Read Receipt -->
            <div class="flex items-end gap-2 justify-end">
                <div class="message-bubble bg-gradient-to-r from-brand-cyan to-brand-purple rounded-2xl rounded-br-none p-3 shadow-sm">
                    <p class="text-white text-sm">I can ship it today if you're ready to proceed.</p>
                    <span class="message-time text-white/80 flex items-center gap-1 mt-1 justify-end">
                        2:36 PM <i class="fa-solid fa-check-double text-blue-300 text-xs"></i>
                    </span>
                </div>
            </div>

            <!-- Received Message -->
            <div class="flex items-start gap-2">
                <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                    class="w-8 h-8 rounded-full">
                <div class="message-bubble bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                    <p class="text-gray-800 dark:text-gray-200 text-sm">Perfect! What's the total with shipping to California?</p>
                    <span class="message-time text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1 justify-end">
                        2:40 PM
                    </span>
                </div>
            </div>

            <!-- Sent Message -->
            <div class="flex items-end gap-2 justify-end">
                <div class="message-bubble bg-gradient-to-r from-brand-cyan to-brand-purple rounded-2xl rounded-br-none p-3 shadow-sm">
                    <p class="text-white text-sm">$850 + $25 shipping = $875 total</p>
                    <span class="message-time text-white/80 flex items-center gap-1 mt-1 justify-end">
                        2:42 PM <i class="fa-solid fa-check-double text-blue-300 text-xs"></i>
                    </span>
                </div>
            </div>

            <!-- Received Message with Image -->
            <div class="flex items-start gap-2">
                <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                    class="w-8 h-8 rounded-full">
                <div class="message-bubble bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                    <p class="text-gray-800 dark:text-gray-200 text-sm">Great! Can you send me more photos?</p>
                    <span class="message-time text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1 justify-end">
                        2:43 PM
                    </span>
                </div>
            </div>

            <!-- Sent Message -->
            <div class="flex items-end gap-2 justify-end">
                <div class="message-bubble bg-gradient-to-r from-brand-cyan to-brand-purple rounded-2xl rounded-br-none p-3 shadow-sm">
                    <p class="text-white text-sm">Sure thing! <i class="fa-solid fa-camera ml-1"></i></p>
                    <span class="message-time text-white/80 flex items-center gap-1 mt-1 justify-end">
                        2:45 PM <i class="fa-solid fa-check text-xs"></i>
                    </span>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div class="flex items-start gap-2">
                <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                    class="w-8 h-8 rounded-full">
                <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                    <div class="flex items-center gap-1">
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Message Input -->
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-md border-t border-gray-200 dark:border-gray-700 p-4">
            <div class="flex items-center gap-3">
                <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                    <i class="fa-solid fa-face-smile text-xl text-gray-600 dark:text-gray-400"></i>
                </button>
                <button class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
                    <i class="fa-solid fa-paperclip text-xl text-gray-600 dark:text-gray-400"></i>
                </button>
                <input type="text" 
                    class="flex-1 bg-gray-100 dark:bg-gray-900 border-none text-gray-900 dark:text-gray-300 text-sm rounded-full focus:ring-brand-purple focus:border-brand-purple px-4 py-2.5 transition-colors"
                    placeholder="Type a message...">
                <button class="bg-gradient-to-r from-brand-cyan to-brand-purple text-white p-3 rounded-full hover:shadow-lg transition-all duration-300 hover:scale-105">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>

    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
    // Auto scroll to bottom of messages
    const messagesContainer = document.getElementById('messages-container');
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Message input handling
    const messageInput = document.querySelector('input[placeholder="Type a message..."]');
    const sendButton = document.querySelector('button:has(.fa-paper-plane)');

    if (messageInput && sendButton) {
        // Send on Enter key
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && messageInput.value.trim() !== '') {
                sendMessage();
            }
        });

        // Send on button click
        sendButton.addEventListener('click', function() {
            if (messageInput.value.trim() !== '') {
                sendMessage();
            }
        });
    }

    function sendMessage() {
        const message = messageInput.value.trim();
        if (message === '') return;

        // TODO: Add your AJAX call here to send message to backend
        console.log('Sending message:', message);
        
        // Clear input
        messageInput.value = '';
        
        // You can add the message to the chat here
        // addMessageToChat(message, 'sent');
    }

    // Example function to add message dynamically
    function addMessageToChat(text, type) {
        const messagesContainer = document.getElementById('messages-container');
        const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        
        let messageHTML = '';
        
        if (type === 'sent') {
            messageHTML = `
                <div class="flex items-end gap-2 justify-end">
                    <div class="message-bubble bg-gradient-to-r from-brand-cyan to-brand-purple rounded-2xl rounded-br-none p-3 shadow-sm">
                        <p class="text-white text-sm">${text}</p>
                        <span class="message-time text-white/80 flex items-center gap-1 mt-1 justify-end">
                            ${time} <i class="fa-solid fa-check text-xs"></i>
                        </span>
                    </div>
                </div>
            `;
        } else {
            messageHTML = `
                <div class="flex items-start gap-2">
                    <img src="https://ui-avatars.com/api/?name=John+Doe&background=00dfd8&color=fff&bold=true" 
                        class="w-8 h-8 rounded-full">
                    <div class="message-bubble bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl rounded-tl-none p-3 shadow-sm">
                        <p class="text-gray-800 dark:text-gray-200 text-sm">${text}</p>
                        <span class="message-time text-gray-500 dark:text-gray-400 flex items-center gap-1 mt-1 justify-end">
                            ${time}
                        </span>
                    </div>
                </div>
            `;
        }
        
        messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
</script>
{% endblock %}